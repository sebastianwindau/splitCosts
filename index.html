<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>splitCosts</title>
</head>
<style>
    body {
        margin: 0;
        background: lightgray;

    }
    #spreadSheet {
        width: 100vw;
        height: 100vh;
        max-width: 450px;
        margin: 0 auto;
        background: palegreen;
        display: grid;
        grid-auto-rows: 100px 50px 50px 50px 1fr;
    }
    #spreadSheet .formvalues {
        display: grid;
        grid-template-columns: 100px 1fr;
        padding: 15px;
        height: 30px;

    }

    #messages {
        display: grid;
        justify-content: center;
        border: 1px solid darkgrey;
    }
    #messages.warning {
        background: lightyellow;
    }
    #messages.info {
         background: darkseagreen;
     }
    #messages.error {
        background: indianred;
    }

    /*label {*/
        /*display: inline-block;*/
        /*width: 25%;*/
    /*}*/
    /*select, input {*/
        /*width: 75%;*/
    /*}*/

</style>
<body>
<div id="spreadSheet">
    <div id="messages" class="warning">
        Bitte melde dich an:
        <button onclick="authenticate().then(loadClient)">Authorisieren</button>
    </div>
    <div id="person" class="formvalues">
        <label for="person">Person: </label>
        <select id="person-select" name="person">
            <option value="" selected disabled>WÃ¤hlen</option>
            <option value="Sebastian">Sebastian</option>
            <option value="Dana">Dana</option>
        </select>
    </div>
    <div id="description" class="formvalues">
        <label for="description">Beschreibung: </label>
        <input type="text" name="description">
    </div>
    <div id="value" class="formvalues">
        <label for="value">Betrag: </label>
        <input type="number" name="value">
    </div>
    <div id="submit">
        <button id="execute" onclick="execute()" disabled>Speichern</button>
    </div>
    <div></div>
</div>

<script src="https://apis.google.com/js/api.js"></script>
<script>
    const INFO = 1;
    const ERROR = 2;
    const WARN = 3;
    //get and set Person by get
    url = new URL(window.location.href);
    person = url.searchParams.get('person');
    password = url.searchParams.get('password');
    isReadyForSubmit = false;
    if(password !== "ksdklrvnnr323ef04k3m") {
        window.location.href ='https://sebastianwindau.github.io/sebastianwindau';
    }

    if(person === "Sebastian" || person === "Dana") {
        element = document.getElementById('person-select');
        element.value = person;
    }


    function showMessage(type, message) {
        let messageClass = "";
        switch (type) {
            case 1:
                messageClass = "info";
                break;
            case 2:
                messageClass = "error";
            case 3:
                messageClass = "warning";
        }
        let id = document.getElementById('messages');
        id.classList.remove('info');
        id.classList.remove('error');
        id.classList.add(messageClass);
        id.innerHTML = message;

    }



    /**
     * Sample JavaScript code for sheets.spreadsheets.values.append
     * See instructions for running APIs Explorer code samples locally:
     * https://developers.google.com/explorer-help/guides/code_samples#javascript
     */

    function authenticate() {
        return gapi.auth2.getAuthInstance()
            .signIn({scope: "https://www.googleapis.com/auth/drive https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/spreadsheets"})
            .then(function() { console.log("Sign-in successful"); },
                function(err) { console.error("Error signing in", err); });
    }
    function loadClient() {
        gapi.client.setApiKey("AIzaSyC_ZUt1AE7geGAmkGS_VblITLxKXBFLyEQ");
        return gapi.client.load("https://content.googleapis.com/discovery/v1/apis/sheets/v4/rest")
            .then(function() {
                    console.log("GAPI client loaded for API");
                    isReadyForSubmit = true;
                    document.getElementById('execute').disabled=false;
                    showMessage(INFO, 'Du bist angemeldet. Trage deine Daten ein und klicke "Speichern"');
                },
                function(err) { console.error("Error loading GAPI client for API", err); });
    }
    // Make sure the client is loaded and sign-in is complete before calling this method.
    function execute() {
        let person = document.getElementById('person-select').value;
        let description = document.getElementsByName("description")[0].value;
        let value = document.getElementsByName("value")[0].value;
        console.log(person);
        console.log(description.length);
        console.log(value);
        if(
            (person === "Sebastian" || person === "Dana")
            && description.length > 0
            && value > 0
        ) {

            return gapi.client.sheets.spreadsheets.values.append({
                "spreadsheetId": "17hunIMwNBzDReC2_U9gXg_QDWvJS7SjwN6_8UXXR_vI",
                "range": person + "!B1",
                "includeValuesInResponse": true,
                "insertDataOption": "INSERT_ROWS",
                "responseDateTimeRenderOption": "FORMATTED_STRING",
                "responseValueRenderOption": "FORMATTED_VALUE",
                "valueInputOption": "RAW",
                "resource": {
                    "values": [
                        [
                            description,
                            parseFloat(value)
                        ]
                    ]
                }
            })
                .then(function (response) {
                        // Handle the results here (response.result has the parsed body
                        if(response.status == 200) {
                            console.log("supi");
                        } else {
                            console.log("Response", response);
                        }
                    },
                    function (err) {
                        console.error("Execute error", err);
                    });
        } else {
            alert("Daten sind nicht korrekt");
        }
    }
    gapi.load("client:auth2", function() {
        gapi.auth2.init({client_id: "358215174432-1rhn3vqub53m5ojobfd0gcp4gcpuh8f5.apps.googleusercontent.com"});
    });
</script>

</body>
</html>